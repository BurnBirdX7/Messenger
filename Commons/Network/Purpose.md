# Цели / Purposes
Каждое сообщение содержит: Заголовок и Тело.\
Заголовок состоит из частей: Длинна_Тела, Байт_Цели, Байт_Задачи.\
Байты цели описаны в этом файле.\
Байт задачи позволяет соотнести запрос с ответом.

## Общие

**Purpose::Common**

Сообщения с Байтом цели из этой группы могут быть отправлены как клиенту, так и серверу.

### Байты ответа
Сообщения помещенные байтами ACCEPTED и DECLINED считаются отвечающими сообщениями
и несут Байт задачи запроса на который они отвечают.

#### Accepted
ACCEPTED\
Обозначает успешное выполнение запрошенной операции.
Сообщение содержащее такой байт цели возвращает также запрошенное содержимое.

#### Declined
DECLINED\
Обозначает отказ в выполнении запрошенной операции или её неуспешное выполнение
(в таком случае содержит строку-сообщение об ошибке).

### Heartbeat
HEARTBEAT\
Такой байт высылается, если сторона хочет удостовериться в том, что соединение активно.

### Disconnect
DISCONNECT\
Сообщение помеченное таким байтом инициирует штатное прекращение соединения.

## К Серверу
**Purpose::to_server**\
Обращения к серверу

### Hello
HELLO\
*Содержит*: MESSAGE_API_MAJOR_VERSION и MESSAGE_API_MINOR_VERSION
- байты, которые указывают на то,
какой набор Байтов цели использует клиент.

### Login
LOGIN\
*Содержит*: requestLogin, password (null-terminated strings).\
При удачной попытке авторизации в ответ сервер должен выслать ACCEPTED сообщение вместе с session_id и session_hash.

### Logoff
LOGOFF\
*Не содержит ничего*.\
При получении такого сообщения сервер должен ликвидировать сессию, ассоциированную с соединением из которого получено 
данное сообщение.

### Restore Session
RESTORE_SESSION\
*Содержит*: session_id, session_hash.\
Запрос на восстановление существующей сессии.
Сервер возвращает ACCEPTED, если авторизация успешна.

### Register New User
REGISTER_USR\
*Содержит*: login, password.\
Запрос на создание нового пользователя

### Get UserID
GET_USER_ID\
*Содержит*: nickname.\
Запрос на получение UserID.
Сервер возвращает ACCEPTED, и ID если такой пользователь был найден и DECLINED в ином случае.

### Get ChatID
GET_CHAT_ID\
*Содержит*: chat_name.\
Запрос на получение ChatID.
Сервер возвращает ACCEPTED, и ID если такая группа была найдена.

## Get chat info by ID
GET_CHAT_BY_ID\
*Содержит*: chat_id.\
Запрашивает информацию о чате (id, имя, название, наличие пароля, тип)

## Get chat info by the chat's nickname
GET_CHAT_BY_NAME\
*Содержит*: chat_name
Делает то же что и "Get chat info by ID", но для идентификации использует никнейм чата

### Join chat
JOIN_CHAT\
*Содержит*: chat_id [, chat_password]\
Запрос добавления пользователя в чат. Пользователь не может быть добавлен в личный чат с помощью данного запроса.
ACCEPTED если пользователь добавлен.

### Leave a chat
LEAVE_CHAT\
*Содержит*: chat_id.\
Запрос пользователя на выход из чата. Пользователь не может покинуть личный чат.

### Create a chat
CREATE_CHAT\
*Содержит*: chat_name [, password].\
Запрос на создание чата. Создающий пользователь получает роль администратора

### Start chat with a user
START_CHAT\
*Содержит*: user_id.\
Запрос на создание личного чата с пользователем. Никто не администратор.

### Delete chat
DELETE_CHAT\
*Содержит*: chat_id.\
Запрос на удаление чата, только администратор может удалить чат

### Change nickname of a chat
RENAME_CHAT\
*Содержит*: chat_id, chat_name.\
Запрос на смену уникального имени чата.

### Set chat administrator
SET_CHAT_ADMIN\
*Содержит*: chat_id, user_id.\
Запрос на добавление администратора в чат.
Может быть выполнен только существующим администратором чата.

### Remove chat administrator
REM_CHAT_ADMIN\
*Содержит*: chat_id, user_id.\
Запрос на удаление администратора чата.
Может быть выполнен только другим администратором чата.

### Get all user's chats
GET_USR_CHATS\
*Ничего не содержит*.

### Send Message
SEND_CHAT_MSG\
*Содержит*: chat_id, chat_message_content.\
Отправка сообщения в чат.

### Request Messages From Chat
REQUEST_CHAT_MSG\
*Содержит*: chat_id, time_older [, time_newer].\
Запрашивает сообщения начиная с даты time_older и до текущего времени или до времени time_newer, если такое указано.
Сервер возвращает все сообщения которые были обновлены или созданы в данный промежуток времени.

### Mark chat seen
MARK_SEEN\
*Содержит*: chat_id, timestamp.\
Отмечает чат chat_id как просмотренный пользователем в последний раз во время timestamp.

### Get time when chat has been seen
GET_SEEN\
*Содержит*: chat_id.\
Возвращает время когда пользователь в последний раз просмотрел чат.

### Remove a message from chat
REMOVE_CHAT_MSG\
*Содержит*: msg_id.\
Запрашивает удаление сообщения из чата.
Сообщение будет удалено только для пользователя сделавшего запрос.

### Delete a message from chat
DELETE_CHAT_MSG\
*Содержит*: msg_id.\
Запрашивает удаление сообщения из чата для всех участников.
Может сделать только автор сообщения или администратор.

### Get public user data
GET_USR_DATA\
*Содержит*: user_id.\
Запрашивает общие данные о пользователе

### Get *private* user data
GET_USR_PR_DATA\
*Ничего не содержит*.\
Запрашивает закрытые данные пользователя (только для текущего авторизованного пользователя)
Кроме публичных данных возвращаются также личные (например, телефон)

### Get list of all sessions
GET_SESSIONS\
*Ничего не содержит*.\
Запрашивает список сессий (их идентификаторы и ассоциированные ip адреса).

## К Клиенту
**Purpose::to_client**\
Сообщения от сервера к клиенту.

Если на эти сообщения в ответ будет получен DECLINE, то сессия будет прервана.

### Send new session data to a clinet
SESSION_DATA\
*Содержит*: session_id, session_str.\
Оповещает клиент о том, что данные его сессии были обновлены

### A client was deauthorized
DEAUTHORIZED\
*Не содержит ничего*.\
Сообщает клиенту о том, что его сессия была деавторизована.

### Send chat message to a client
NTF_CHAT_MSG\
*Содержит*: chat_id, chat_message_pack.\
Оповещает клиент о том, что в один из чатов авторизованного пользователя поступило сообщение.

### Send JOIN_CHAT notification
NTF_JOIN_CHAT\
*Содержит*: chat_info.\
Оповещает клиент о том, что авторизованный через него пользователь присоединился к чату.
Такое оповещение будет выслано, если пользователь присоединился к чату через другое соединение.

### Send LEAVE_CHAT notification
NTF_LEAVE_CHAT\
*Содержит*: chat_info.\
Аналогично предыдущему, но для действия LEAVE_CHAT